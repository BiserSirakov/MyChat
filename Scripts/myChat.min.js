function showModalUserLogin(){var n=alertify.prompt("Enter your name to start:","Biser Sirakov",function(n,t){$("#nickname").val(t.toUpperCase());$(".chat-title h1 span").html(t);startChatHub()}).setHeader("Welcome to MyChat").setting({closableByDimmer:!1,closable:!1,movable:!1,transition:"fade",labels:{ok:"Enter"}}),t=$(n.elements.footer.querySelector("button.ajs-cancel"));t.remove()}function startChatHub(){var n=$.connection.myChatHub;registerClientMethods(n);$.connection.hub.start().done(function(){registerEvents(n);n.server.connect($("#nickname").val())})}function registerClientMethods(n){n.client.differentName=function(){alertify.error("Name in use");showModalUserLogin()};n.client.onConnected=function(n,t,i){t.forEach(function(t){if(t.UserName!=n){$onlineUsers.append('<div class="online-user"><h1>'+t.UserName+'<\/h1><figure class="avatar"><img src="/Images/avatar.jpg" /><\/figure><\/div>');var i=$('<div class="messages-content" data="'+t.UserName.toUpperCase()+'"><\/div>');$(".messages").append(i);i.mCustomScrollbar()}});i.forEach(function(n){n.UserName==$("#nickname").val()?$('<div class="message message-personal">'+n.Message+"<\/div>").appendTo($('.messages-content[data="GROUP CHAT"] .mCSB_container')).addClass("new"):$('<div class="message new" style="margin-top: 20px;"><figure class="avatar"><img src="/Images/avatar.jpg" /><\/figure>'+n.Message+'<div class="message-username">'+n.UserName+"<\/div><\/div>").appendTo($('.messages-content[data="GROUP CHAT"] .mCSB_container')).addClass("new")});$('.messages-content[data="GROUP CHAT"]').mCustomScrollbar()};n.client.onNewUserConnected=function(n){n=n.toUpperCase();alertify.success(n+" joined the chat");$onlineUsers.append('<div class="online-user"><h1>'+n+'<\/h1><figure class="avatar"><img src="/Images/avatar.jpg" /><\/figure><\/div>');var t=$('<div class="messages-content" data="'+n.toUpperCase()+'"><\/div>');$(".messages").append(t);t.mCustomScrollbar()};n.client.onUserDisconnected=function(n){alertify.error(n+" left the chat");$(".online-user").remove(":contains('"+n.toUpperCase()+"')");$('.messages-content[data="'+n.toUpperCase()+'"]').remove()};n.client.messageReceived=function(n,t){if(t=getEmoticons(t),$.trim(t)=="")return!1;n==$("#nickname").val()?$('<div class="message message-personal">'+t+"<\/div>").appendTo($('.messages-content[data="GROUP CHAT"] .mCSB_container')).addClass("new"):$('<div class="message new" style="margin-top: 20px;"><figure class="avatar"><img src="/Images/avatar.jpg" /><\/figure>'+t+'<div class="message-username">'+n+"<\/div><\/div>").appendTo($('.messages-content[data="GROUP CHAT"] .mCSB_container')).addClass("new");updateScrollbar()};n.client.getMessage=function(n,t){if(t=getEmoticons(t),$.trim(t)=="")return!1;$('<div class="message new"><figure class="avatar"><img src="/Images/avatar.jpg" /><\/figure>'+t+"<\/div>").appendTo($('.messages-content[data="'+n+'"] .mCSB_container')).addClass("new");updateScrollbar()};n.client.getMyMessage=function(n,t){if(t=getEmoticons(t),$.trim(t)=="")return!1;$('<div class="message message-personal">'+t+"<\/div>").appendTo($('.messages-content[data="'+n+'"] .mCSB_container')).addClass("new");updateScrollbar()}}function registerEvents(n){$("#attachment").change(function(t){t.preventDefault();var i=new FormData,r=document.querySelector("input#attachment");r.files[0]&&(i.append("file",r.files[0]),$.ajax({url:"/Home/UploadFile",data:i,processData:!1,contentType:!1,type:"POST",success:function(t){var i='<a class="uploaded-file" download target="_blank" href="/Uploads/'+t.fileName+'"><i class="fa fa-file" aria-hidden="true"><\/i> '+t.fileName+"<\/a>";$("#to").val()=="GROUP CHAT"?n.server.sendMessageToAll($("#nickname").val(),i):n.server.sendPrivateMessage($("#to").val(),i);updateScrollbar()}}))});$onlineUsers.on("click",".online-user",function(){var n=$(this).children("h1").text().toUpperCase();$onlineUsers.removeClass("shown");$('.messages-content[data="'+n+'"]').addClass("shown");$messageBox.addClass("shown");$closeBtn.addClass("shown");n=="GROUP CHAT"&&$(".chat-title figure").hide();$(".chat-title figure img").attr("src","/Images/avatar.jpg");$(".chat-title h1 span").html(n);$("#to").val(n);updateScrollbar()});$closeBtn.on("click",function(){$closeBtn.removeClass("shown");$('.messages-content[data="'+$("#to").val().toUpperCase()+'"]').removeClass("shown");$messageBox.removeClass("shown");$onlineUsers.addClass("shown");$(".chat-title figure").css("display")=="none"&&$(".chat-title figure").show();$(".chat-title figure img").attr("src","/Images/profile-80.jpg");$(".chat-title h1 span").html($("#nickname").val())});$(".message-input").on("keydown",function(t){t.which==13&&($("#to").val()=="GROUP CHAT"?n.server.sendMessageToAll($("#nickname").val(),$(".message-input").val()):n.server.sendPrivateMessage($("#to").val(),$(".message-input").val()),updateScrollbar(),$(".message-input").val(""))})}function updateScrollbar(){$(".messages-content").mCustomScrollbar("update").mCustomScrollbar("scrollTo","bottom",{scrollInertia:10,timeout:0})}function getEmoticons(n){return n=n.replace(":)",'<img src="/images/emoticons/smile.gif" class="smileys" />'),n=n.replace("lol",'<img src="/images/emoticons/laugh.gif" class="smileys" />'),n.replace(":o",'<img src="/images/emoticons/cool.gif" class="smileys" />')}var $onlineUsers=$(".online-users"),$messageBox=$(".message-box"),$closeBtn=$(".close-btn");$(function(){showModalUserLogin();$("#group-chat").mCustomScrollbar()});